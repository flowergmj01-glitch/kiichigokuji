<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¨è“FRUCTOSEï¼šç”œèœœç…‰é‡‘è¡“</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fdf2f8; /* pink-50 */
        }

        /* Custom Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 1; }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }
        .animate-bounce-in {
            animation: bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }

        @keyframes spinSlow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spinSlow 8s linear infinite;
        }

        @keyframes bounceSmall {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce-small {
            animation: bounceSmall 2s infinite;
        }
        
        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- Icons Components (SVG replacement for Lucide) ---
        const IconBase = ({ size = 24, className = "", children }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Sparkles = (props) => (
            <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/><path d="M3 5h4"/></IconBase>
        );
        const FlaskConical = (props) => (
            <IconBase {...props}><path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2"/><path d="M8.5 2h7"/><path d="M7 16h10"/></IconBase>
        );
        const ShoppingBag = (props) => (
            <IconBase {...props}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></IconBase>
        );
        const Coins = (props) => (
            <IconBase {...props}><circle cx="8" cy="8" r="6"/><path d="M18.09 10.37A6 6 0 1 1 10.34 18"/><path d="M7 6h1v4"/><path d="m16.71 13.88.7 .71-2.82 2.82"/></IconBase>
        );
        const Trash2 = (props) => (
            <IconBase {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>
        );
        const Zap = (props) => (
            <IconBase {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></IconBase>
        );
        const Crown = (props) => (
            <IconBase {...props}><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></IconBase>
        );
        const Heart = (props) => (
            <IconBase {...props}><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></IconBase>
        );
        const Gift = (props) => (
            <IconBase {...props}><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></IconBase>
        );
        const Ticket = (props) => (
            <IconBase {...props}><path d="M2 9a3 3 0 0 1 0 6v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2a3 3 0 0 1 0-6V7a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/><path d="M13 5v2"/><path d="M13 17v2"/><path d="M13 11v2"/></IconBase>
        );
        const X = (props) => (
            <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 12 12"/></IconBase>
        );
        const ThumbsUp = (props) => (
            <IconBase {...props}><path d="M7 10v12"/><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z"/></IconBase>
        );
        const BookOpen = (props) => (
            <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></IconBase>
        );


        // --- é…ç½®èˆ‡è³‡æ–™ ---
        const TIERS = {
          UR: { label: 'UR', name: 'å‚³èªªç´šå¹»æƒ³', color: 'text-rose-600', bg: 'bg-rose-100', border: 'border-rose-400', probability: 0.005, icon: 'ğŸ‘‘' },
          SSR: { label: 'SSR', name: 'è¶…ç¨€æœ‰å¥¢è¯', color: 'text-amber-500', bg: 'bg-amber-100', border: 'border-amber-400', probability: 0.025, icon: 'âœ¨' },
          SR: { label: 'SR', name: 'ç¨€æœ‰äº’å‹•', color: 'text-purple-500', bg: 'bg-purple-100', border: 'border-purple-300', probability: 0.12, icon: 'ğŸ’–' },
          R: { label: 'R', name: 'æ¨™æº–ç‰©è³‡', color: 'text-blue-500', bg: 'bg-blue-100', border: 'border-blue-300', probability: 0.35, icon: 'ğŸ€' },
          N: { label: 'N', name: 'å¡«å……èˆ‡è€—æ', color: 'text-slate-500', bg: 'bg-white', border: 'border-slate-300', probability: 0.50, icon: 'ğŸ“' },
        };

        const ITEMS_DATA = {
          UR: [
            "å°ˆå±¬ 10min è¦–è¨Šé€šè©±", 
            "æ‰‹å¯«ç§å¯†ä¿¡ä»¶", 
            "ä¸€æ—¥ç¶“ç´€äººé«”é©—", 
            "å…¨æˆå“¡ç°½åå¯¬å¹…å¤§åˆç…§", 
            "è·Ÿæ¨ä¸€èµ·æ‹æ‹è²¼æ©Ÿ", 
            "è·Ÿæ¨ä¸€èµ·å»é›»è©±äº­KTV(5åˆ†é˜)"
          ],
          SSR: [
            "æœ¨è‹ºä¸»å‚¬VIPå¿…ä¸­å·",
            "å¯¬å¹…æ‹åˆ¸", 
            "15ç§’å®¢è£½åŒ–å½±ç‰‡åˆ¸", 
            "æˆå“¡çš„éš¨èº«å°ç‰© (è¤‡è£½å“)",
            "æŒ‡å®šæˆå“¡ã€Œç¥å°æ‡‰ã€ç°½ç¹ªæ¿", 
            "å¾Œå°è¦–è§’æ‹ç«‹å¾—",
            "ä»Šæ—¥æ­Œå–®(æŒ‘ä¸€æˆå“¡ç°½åç•™è¨€)", 
            "è·Ÿæˆå“¡ä¸€èµ·ç—›æ‰“é‡‘æ—‹é¢¨20ç§’(å¯éŒ„å½±)", 
            "ä»»é¸ç°½åæ‹åˆ¸5å¼µ"
          ],
          SR: [
            "ç—›æ‰“é‡‘æ—‹é¢¨å·",
            "æˆå“¡æ‰‹ç¹ªæ’²å…‹ç‰Œæ‹ç«‹å¾—",
            "ç°½æ‹æ‹åˆ¸ (æŒ‡å®šæˆå“¡)", 
            "æ‰‹æ©Ÿæ‹åˆ¸ (è‡ªé¸æ¿¾é¡)", 
            "10ç§’èªéŸ³è¨Šæ¯åˆ¸", 
            "æˆå“¡ç‰¹è£½æ‰‹æ©Ÿæ¡Œå¸ƒ (æ•¸ä½)",
            "éš¨æ©Ÿç²¾ç·»æ‹ (Random Deco Cheki)", 
            "åŠ æ™‚åˆ¸ (30ç§’)", 
            "æ’éšŠåˆ¸ (Fast Pass)",
            "é›™äººåˆç…§åˆ¸ (2 Shot)",
            "ç°¡æ˜“ç°½ç¹ªæ³³è£æ‹(éš¨æ©Ÿ)"
          ],
          R: [
            "éš¨æ©Ÿæˆå“¡ç™½æ‹ (ç„¡ç°½å)", 
            "ç™½æ‹æ‹åˆ¸ (æŒ‡å®šæˆå“¡)", 
            "ç°½ç¹ªåˆ¸ (ç‰©å“)", 
            "æœ¨è“åˆ¸ (é€šç”¨é»æ•¸)",
            "éš¨æ©Ÿç”Ÿå¯«çœŸ (Låˆ¤)", 
            "æˆå“¡å¡—é´‰è²¼ç´™", 
            "YUA é¡è—ä¸‰ç¨®(ä¸å¯æ”å½±)",
            "MADOKA å¹«ä½ ç¶é›™é¦¬å°¾(50ç§’äº¤æµ)", 
            "SANE å¹«ä½ MBTIæˆ–åˆ†æè‚¡ç¥¨(50ç§’äº¤æµ)", 
            "SAKANA æ¨è–¦ä½ åƒç”œé»(50ç§’äº¤æµ)",
            "MEGU ä¸€èµ·äºŒè¸(20ç§’)", 
            "æ„Ÿè¬æ¡æ‰‹åˆ¸ (3ç§’)"
          ],
          N: [
            "æ‹ç«‹å¾—è²·ä¸€é€ä¸€åˆ¸",
            "çœ¼ç¥é—œæ„›åˆ¸(5ç§’ ç„¡äº¤æµ)", 
            "æˆå“¡è¡¨æƒ…åŒ…è²¼ç´™(A é¬¥é›çœ¼)", 
            "æˆå“¡è¡¨æƒ…åŒ…è²¼ç´™(B çœ¨çœ¼)",   
            "æˆå“¡è¡¨æƒ…åŒ…è²¼ç´™(C ç«Šç¬‘)",   
            "æˆå“¡è¡¨æƒ…åŒ…è²¼ç´™(D æ€’æ€’è‡‰)", 
            "æˆå“¡è¡¨æƒ…åŒ…è²¼ç´™(E æ²’ç€æµ·ç‰¹æ®Šé€ å‹)", 
            "é¢ç´™ä¸€åŒ… (å°æœ‰Logo)", 
            "å·¥ä½œäººå“¡çš„ç¨±è®š", 
            "é‡‘æ—‹é¢¨å¾®ç¬‘ä¸€ç§’"
          ]
        };

        // --- å·¥å…·å‡½æ•¸ ---
        const getRandomItem = (tier) => {
          const list = ITEMS_DATA[tier];
          return list[Math.floor(Math.random() * list.length)];
        };

        const determineTier = () => {
          const rand = Math.random();
          let cumulative = 0;
          if (rand < (cumulative += TIERS.UR.probability)) return 'UR';
          if (rand < (cumulative += TIERS.SSR.probability)) return 'SSR';
          if (rand < (cumulative += TIERS.SR.probability)) return 'SR';
          if (rand < (cumulative += TIERS.R.probability)) return 'R';
          return 'N';
        };

        const getTierOrder = (tier) => {
          const order = ['N', 'R', 'SR', 'SSR', 'UR'];
          return order.indexOf(tier);
        };

        const getNextTier = (tier) => {
          const order = ['N', 'R', 'SR', 'SSR', 'UR'];
          const idx = order.indexOf(tier);
          return idx < order.length - 1 ? order[idx + 1] : null;
        };

        // --- çŒœæ‹³çµ„ä»¶ ---
        const RockPaperScissorsModal = ({ onClose, onWin, onLoseAction }) => {
          const [gameState, setGameState] = useState('choice'); // choice, result
          const [userChoice, setUserChoice] = useState(null);
          const [cpuChoice, setCpuChoice] = useState(null);
          const [result, setResult] = useState(null); // win, lose, draw

          const choices = [
            { id: 'rock', icon: 'âœŠ', label: 'çŸ³é ­' },
            { id: 'paper', icon: 'ğŸ–ï¸', label: 'å¸ƒ' },
            { id: 'scissors', icon: 'âœŒï¸', label: 'å‰ªåˆ€' }
          ];

          const handleChoice = (choiceId) => {
            const cpu = choices[Math.floor(Math.random() * choices.length)];
            setUserChoice(choices.find(c => c.id === choiceId));
            setCpuChoice(cpu);
            
            let res = 'draw';
            if (choiceId === cpu.id) {
              res = 'draw';
            } else if (
              (choiceId === 'rock' && cpu.id === 'scissors') ||
              (choiceId === 'paper' && cpu.id === 'rock') ||
              (choiceId === 'scissors' && cpu.id === 'paper')
            ) {
              res = 'win';
            } else {
              res = 'lose';
            }
            
            setResult(res);
            setGameState('result');

            if (res === 'win') {
              setTimeout(() => {
                onWin();
              }, 1500); 
            }
          };

          const handleReset = () => {
            setGameState('choice');
            setUserChoice(null);
            setCpuChoice(null);
            setResult(null);
          };

          return (
            <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
              <div className="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl border-4 border-pink-200 animate-bounce-in">
                <div className="flex justify-between items-center mb-4">
                  <h3 className="text-xl font-black text-pink-500">ğŸ“ æ²’éŒ¢äº†å—ï¼Ÿä¾†çŒœæ‹³ï¼</h3>
                  <button onClick={onClose} className="text-slate-400 hover:text-slate-600"><X size={24}/></button>
                </div>

                {gameState === 'choice' && (
                  <div className="text-center py-4">
                    <p className="mb-6 font-bold text-slate-600">è´äº†é€ 2000 å¹£ (20æŠ½)ï¼</p>
                    <div className="flex justify-center gap-4">
                      {choices.map(c => (
                        <button 
                          key={c.id}
                          onClick={() => handleChoice(c.id)}
                          className="w-20 h-20 rounded-2xl bg-pink-50 border-2 border-pink-200 hover:bg-pink-100 hover:scale-110 transition-all text-4xl flex items-center justify-center shadow-sm"
                        >
                          {c.icon}
                        </button>
                      ))}
                    </div>
                  </div>
                )}

                {gameState === 'result' && (
                  <div className="text-center py-4">
                     <div className="flex justify-center items-center gap-8 text-5xl mb-6">
                        <div className="animate-bounce-small">
                          <div className="text-xs font-bold text-slate-400 mb-2">ä½ </div>
                          {userChoice.icon}
                        </div>
                        <div className="text-2xl font-black text-slate-300">VS</div>
                        <div className="animate-bounce-small" style={{ animationDelay: '0.1s' }}>
                           <div className="text-xs font-bold text-slate-400 mb-2">æœ¨è“</div>
                           {cpuChoice.icon}
                        </div>
                     </div>

                     {result === 'draw' && (
                       <div>
                         <p className="text-lg font-bold text-slate-500 mb-4">å¹³æ‰‹ï¼å†ä¾†ä¸€æ¬¡ï¼</p>
                         <button onClick={handleReset} className="px-6 py-2 bg-slate-200 rounded-full font-bold text-slate-600">é‡ä¾†</button>
                       </div>
                     )}

                     {result === 'win' && (
                       <div>
                         <p className="text-2xl font-black text-amber-500 mb-2">ä½ è´äº†ï¼ğŸ‰</p>
                         <p className="text-sm text-slate-400">æ­£åœ¨ç™¼é€çå‹µ...</p>
                       </div>
                     )}

                     {result === 'lose' && (
                       <div className="animate-fade-in">
                         <p className="text-lg font-bold text-slate-400 mb-4">å—šå—šè¼¸äº†...æ²’é—œä¿‚ï¼</p>
                         <button 
                           onClick={onLoseAction}
                           className="w-full bg-gradient-to-r from-pink-500 to-rose-500 text-white font-bold p-4 rounded-xl shadow-lg hover:shadow-pink-200 hover:scale-[1.02] transition-all flex items-center justify-center gap-2 text-sm"
                         >
                           <ThumbsUp size={18} />
                           æˆ‘å·²ç¶“é‚€è«‹3ä½æœ‹å‹æŒ‰è®šæœ¨è“æˆå“¡IG<br/>è«‹çµ¦æˆ‘10æŠ½çš„éŒ¢
                         </button>
                       </div>
                     )}
                  </div>
                )}
              </div>
            </div>
          );
        };

        // --- ä¸»æ‡‰ç”¨çµ„ä»¶ ---
        const App = () => {
          const [coins, setCoins] = useState(1000); 
          const [inventory, setInventory] = useState([]);
          const [selectedIds, setSelectedIds] = useState([]);
          const [activeTab, setActiveTab] = useState('gacha'); 
          const [lastDraw, setLastDraw] = useState(null);
          const [alchemyResult, setAlchemyResult] = useState(null);
          const [inventoryView, setInventoryView] = useState('owned'); 
          
          const [showRPS, setShowRPS] = useState(false);

          const handleDraw = (amount = 1) => {
            const cost = amount * 100;
            
            if (coins < cost) {
              setShowRPS(true);
              return;
            }

            const newItems = [];
            for (let i = 0; i < amount; i++) {
              const tier = determineTier();
              const itemName = getRandomItem(tier);
              newItems.push({
                id: Date.now() + i + Math.random(),
                tier,
                name: itemName,
                isNew: true
              });
            }

            setCoins(prev => prev - cost);
            setInventory(prev => [...newItems, ...prev]);
            setLastDraw(newItems);
            setAlchemyResult(null);
          };

          const handleRPSWin = () => {
            setCoins(prev => prev + 2000); 
            setShowRPS(false);
            alert("æ­å–œè´å¾— 2000 è“æœå¹£ï¼ğŸ“");
          };

          const handleRPSLoseAction = () => {
            setCoins(prev => prev + 1000); 
            setShowRPS(false);
            alert("æ„Ÿè¬æ”¯æŒï¼ç²å¾— 1000 è“æœå¹£ä½œç‚ºçå‹µï¼ğŸ“");
          };

          // ç…‰é‡‘é‚è¼¯ï¼šéœ€è¦ 4 å€‹ç‰©å“
          const handleTransmute = () => {
            if (selectedIds.length !== 4) return;

            const item1 = inventory.find(i => i.id === selectedIds[0]);

            if (!item1) {
              alert("ç…‰é‡‘å¤±æ•—ï¼šç‰©å“éŒ¯èª¤");
              return;
            }

            setInventory(prev => prev.filter(i => !selectedIds.includes(i.id)));
            setSelectedIds([]);

            const currentTier = item1.tier;
            // æˆåŠŸæ©Ÿç‡ > 0.33 (67% æˆåŠŸ)
            const isSuccess = Math.random() > 0.33;
            
            let resultItem;
            let resultStatus;

            if (isSuccess && currentTier !== 'UR') {
              const nextTier = getNextTier(currentTier);
              const newItemName = getRandomItem(nextTier);
              resultItem = {
                id: Date.now(),
                tier: nextTier,
                name: newItemName,
                isNew: true
              };
              resultStatus = 'success';
            } else {
              const slagName = getRandomItem('N');
              resultItem = {
                id: Date.now(),
                tier: 'N',
                name: slagName,
                isNew: true
              };
              resultStatus = 'fail';
            }

            setInventory(prev => [resultItem, ...prev]);
            setAlchemyResult({ status: resultStatus, item: resultItem, fromTier: currentTier });
          };

          const toggleSelection = (id) => {
            if (activeTab !== 'alchemy') return;

            const item = inventory.find(i => i.id === id);
            if (!item) return;

            if (item.tier === 'UR') {
              alert("å‚³èªªç´šå¹»æƒ³éæ–¼å¼·å¤§ï¼Œç„¡æ³•æ”¾å…¥ç…‰é‡‘çˆï¼");
              return;
            }

            if (selectedIds.includes(id)) {
              setSelectedIds(prev => prev.filter(sid => sid !== id));
            } else {
              if (selectedIds.length > 0) {
                const firstItem = inventory.find(i => i.id === selectedIds[0]);
                if (firstItem && firstItem.tier !== item.tier) {
                  alert("ç…‰é‡‘å¿…é ˆä½¿ç”¨åŒéšç´šç‰©å“ï¼");
                  return;
                }
              }

              if (selectedIds.length >= 4) {
                setSelectedIds(prev => [...prev.slice(1), id]);
              } else {
                setSelectedIds(prev => [...prev, id]);
              }
            }
          };

          const sortedInventory = useMemo(() => {
            return [...inventory].sort((a, b) => {
                const tierDiff = getTierOrder(b.tier) - getTierOrder(a.tier);
                if (tierDiff !== 0) return tierDiff;
                return a.name.localeCompare(b.name);
            });
          }, [inventory]);

          const ItemCard = ({ item, isSelected, onClick, count = 0, isCollectionMode = false, isOwned = true }) => {
            const style = TIERS[item.tier];
            
            if (isCollectionMode && !isOwned) {
              return (
                <div className="relative p-3 rounded-2xl border-2 border-slate-200 bg-slate-100 opacity-60 grayscale cursor-not-allowed">
                   <div className="flex justify-between items-start mb-2">
                    <span className="font-bold text-[10px] px-2 py-0.5 rounded-full bg-slate-300 text-slate-500 border border-slate-300 flex items-center gap-1">
                      {style.icon} {style.label}
                    </span>
                  </div>
                  <div className="text-sm font-bold leading-tight min-h-[2.5rem] flex items-center text-slate-400">
                    {item.name}
                  </div>
                  <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                     <div className="bg-slate-300/20 px-2 py-1 rounded text-[10px] font-bold text-slate-500">æœªè§£é–</div>
                  </div>
                </div>
              );
            }

            return (
              <div 
                onClick={() => onClick && onClick(item.id)}
                className={`
                  relative p-3 rounded-2xl border-2 cursor-pointer transition-all duration-200 shadow-sm
                  ${style.bg} ${style.border} 
                  ${isSelected ? 'ring-4 ring-pink-300 scale-105 z-10 shadow-lg' : 'hover:scale-102 hover:shadow-md'}
                `}
              >
                <div className="flex justify-between items-start mb-2">
                  <span className={`font-bold text-[10px] px-2 py-0.5 rounded-full bg-white/80 backdrop-blur-sm border ${style.border} ${style.color} shadow-sm flex items-center gap-1`}>
                    {style.icon} {style.label}
                  </span>
                  {item.tier === 'UR' && <Crown size={16} className="text-rose-500 animate-pulse" />}
                  {item.tier === 'N' && item.name === 'æœ¨è“æ¸£ (å®‰æ…°ç)' && <Trash2 size={16} className="text-gray-400" />}
                </div>
                <div className={`text-sm font-bold leading-tight min-h-[2.5rem] flex items-center ${item.tier === 'N' ? 'text-slate-600' : 'text-slate-700'}`}>
                  {item.name}
                </div>
                {isSelected && (
                   <div className="absolute inset-0 bg-pink-500/10 flex items-center justify-center rounded-2xl backdrop-blur-[1px]">
                     <div className="bg-white text-pink-500 p-2 rounded-full shadow-lg animate-bounce">
                       <Heart size={20} fill="currentColor" />
                     </div>
                   </div>
                )}
                
                {isCollectionMode && count > 0 && (
                  <div className="absolute -top-2 -right-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white text-xs font-black px-2 py-0.5 rounded-full shadow-md border-2 border-white transform scale-100 animate-bounce-small">
                    x{count}
                  </div>
                )}
              </div>
            );
          };

          return (
            <div className="min-h-screen bg-pink-50 text-slate-800 font-sans selection:bg-pink-200 selection:text-pink-900 pb-24">
              
              {showRPS && (
                <RockPaperScissorsModal 
                  onClose={() => setShowRPS(false)} 
                  onWin={handleRPSWin}
                  onLoseAction={handleRPSLoseAction}
                />
              )}

              <div className="fixed inset-0 pointer-events-none opacity-5" 
                   style={{ backgroundImage: 'radial-gradient(circle, #ff99aa 1px, transparent 1px)', backgroundSize: '20px 20px' }}>
              </div>

              <header className="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-pink-200 p-4 shadow-sm">
                <div className="max-w-md mx-auto flex justify-between items-center">
                  <div className="flex items-center gap-2">
                    <div className="bg-pink-100 p-1.5 rounded-full">
                      <span className="text-xl">ğŸ“</span>
                    </div>
                    <div>
                      <h1 className="text-lg font-black text-pink-500 tracking-tight">
                        æœ¨è“FRUCTOSE
                      </h1>
                      <p className="text-[10px] font-bold text-pink-300 tracking-widest">SWEET ALCHEMY</p>
                    </div>
                  </div>
                  <div className="flex items-center gap-2 bg-white px-3 py-1.5 rounded-full border-2 border-pink-100 shadow-sm">
                    <Coins size={16} className="text-yellow-400 fill-yellow-400" />
                    <span className="font-mono font-bold text-slate-600">{coins}</span>
                    <button 
                        onClick={() => setShowRPS(true)}
                        className="ml-2 w-5 h-5 flex items-center justify-center rounded-full bg-pink-400 text-white text-[10px] hover:bg-pink-500 transition-colors shadow-sm"
                    >
                        +
                    </button>
                  </div>
                </div>
              </header>

              <main className="max-w-md mx-auto p-4 space-y-6 relative z-10">

                {activeTab === 'gacha' && (
                  <div className="space-y-6 animate-fade-in">
                    <div className="relative overflow-hidden rounded-3xl bg-gradient-to-br from-pink-400 to-rose-400 border-4 border-white p-6 text-center shadow-xl shadow-pink-200">
                      <div className="absolute -top-10 -right-10 w-32 h-32 bg-white/20 rounded-full blur-2xl"></div>
                      <div className="absolute -bottom-10 -left-10 w-32 h-32 bg-yellow-200/30 rounded-full blur-2xl"></div>
                      
                      <Sparkles className="mx-auto text-white mb-2 animate-spin-slow" size={40} />
                      <h2 className="text-2xl font-black text-white mb-1 drop-shadow-md">å¹¸é‹è‰è“ç…‰æˆé™£</h2>
                      <p className="text-sm text-pink-50 font-medium mb-6">æŠ•å…¥è“æœå¹£ï¼Œå°‹æ‰¾å‚³èªªä¸­çš„å¹»ä¹‹é€¸å“</p>
                      
                      <div className="grid grid-cols-2 gap-4">
                        <button 
                          onClick={() => handleDraw(1)}
                          className="group relative overflow-hidden rounded-2xl bg-white p-3 hover:bg-pink-50 transition-all shadow-md active:scale-95"
                        >
                          <div className="text-xs text-slate-400 mb-1 font-bold">å–®æ¬¡ç…‰æˆ</div>
                          <div className="text-xl font-black text-pink-500">100 å¹£</div>
                          <div className="absolute inset-0 bg-pink-200/20 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        </button>
                        <button 
                          onClick={() => handleDraw(10)}
                          className="group relative overflow-hidden rounded-2xl bg-gradient-to-b from-yellow-300 to-yellow-400 p-3 transition-all shadow-lg active:scale-95 border-2 border-white/50"
                        >
                          <div className="text-xs text-yellow-800/70 mb-1 font-bold">åé€£ç…‰æˆ</div>
                          <div className="text-xl font-black text-yellow-900">1000 å¹£</div>
                          <div className="absolute -right-3 -top-3 bg-red-500 text-white text-[9px] font-bold px-3 py-1 rotate-12 shadow-sm">
                            HOT
                          </div>
                          <Sparkles className="absolute bottom-1 right-1 text-white/50" size={16} />
                        </button>
                      </div>
                    </div>

                    {lastDraw && (
                      <div className="space-y-3 bg-white p-4 rounded-3xl shadow-sm border border-pink-100">
                        <div className="flex justify-between items-center px-1">
                          <h3 className="text-lg font-bold text-slate-700 flex items-center gap-2">
                            <Gift className="text-pink-400" size={20} />
                            ç…‰æˆçµæœ
                          </h3>
                          <button onClick={() => setLastDraw(null)} className="text-xs text-pink-400 font-bold hover:text-pink-600">æ¸…é™¤</button>
                        </div>
                        <div className="grid grid-cols-2 gap-3">
                          {lastDraw.map((item) => (
                            <ItemCard key={item.id} item={item} />
                          ))}
                        </div>
                      </div>
                    )}
                    
                    <div className="rounded-2xl bg-white p-5 border border-pink-100 shadow-sm">
                      <h4 className="font-bold mb-3 text-slate-400 text-xs uppercase tracking-wider text-center">æ©Ÿç‡å…¬ç¤º</h4>
                      <div className="space-y-2 text-xs">
                        {Object.entries(TIERS).reverse().map(([key, val]) => (
                          <div key={key} className="flex justify-between items-center p-2 rounded-lg bg-slate-50">
                            <span className={`font-bold flex items-center gap-1 ${val.color}`}>
                              {val.icon} {val.label} {val.name}
                            </span>
                            <span className="font-mono font-bold text-slate-400">{(val.probability * 100).toFixed(1)}%</span>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                )}

                {activeTab === 'alchemy' && (
                  <div className="space-y-6 animate-fade-in">
                     <div className="rounded-3xl bg-white border-4 border-rose-100 p-6 text-center relative overflow-hidden shadow-xl shadow-rose-100/50">
                        <div className="absolute -top-10 -left-10 w-24 h-24 bg-rose-200 rounded-full blur-2xl opacity-50"></div>
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-5"></div>
                        
                        <div className="relative z-10">
                          <div className="w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-3 shadow-inner">
                            <FlaskConical className="text-rose-500 ml-1" size={32} />
                          </div>
                          <h2 className="text-xl font-black text-rose-500">è³­å¾’çš„ç†”çˆ</h2>
                          <p className="text-xs text-rose-400 mb-6 font-medium bg-rose-50 inline-block px-3 py-1 rounded-full">
                            æŠ•å…¥ 4 å€‹ç´ æ ğŸ”¥ / 33% å¤±æ•—ç‡ ğŸ’¥
                          </p>

                          <div className="grid grid-cols-4 gap-2 mb-8">
                            {[0, 1, 2, 3].map((index) => (
                               <div key={index} className={`aspect-[3/4] rounded-xl border-2 border-dashed flex flex-col items-center justify-center transition-all duration-300 ${selectedIds[index] ? 'border-rose-400 bg-rose-50 shadow-md' : 'border-slate-300 bg-slate-50'}`}>
                                 {selectedIds[index] ? (
                                   <div className="text-2xl animate-bounce-small">ğŸ</div>
                                 ) : (
                                   <span className="text-slate-300 text-[10px] font-bold text-center leading-none">
                                     Slot<br/>{index + 1}
                                   </span>
                                 )}
                               </div>
                            ))}
                          </div>

                          <button
                            disabled={selectedIds.length !== 4}
                            onClick={handleTransmute}
                            className={`
                              w-full py-4 rounded-2xl font-black text-lg shadow-lg flex items-center justify-center gap-2 transition-all active:scale-95
                              ${selectedIds.length === 4 
                                ? 'bg-rose-500 hover:bg-rose-600 text-white shadow-rose-200' 
                                : 'bg-slate-200 text-slate-400 cursor-not-allowed'}
                            `}
                          >
                            <Zap size={20} className={selectedIds.length === 4 ? 'fill-yellow-300 text-yellow-300' : ''} />
                            é–‹å§‹ç†”ç…‰
                          </button>
                        </div>
                     </div>

                     {alchemyResult && (
                       <div className={`p-6 rounded-3xl border-4 text-center animate-bounce-in shadow-xl ${alchemyResult.status === 'success' ? 'bg-amber-50 border-amber-200' : 'bg-slate-100 border-slate-200'}`}>
                         <div className="text-4xl mb-2">{alchemyResult.status === 'success' ? 'ğŸ‰' : 'ğŸ’¥'}</div>
                         <h3 className={`font-black text-xl mb-1 ${alchemyResult.status === 'success' ? 'text-amber-500' : 'text-slate-500'}`}>
                           {alchemyResult.status === 'success' ? 'ç…‰é‡‘å¤§æˆåŠŸï¼' : 'ç…‰é‡‘å¤±æ•—...'}
                         </h3>
                         <p className="text-sm text-slate-500 mb-4 font-bold">
                           {alchemyResult.status === 'success' ? 'å¤ªç¥å•¦ï¼ç²å¾—äº†é«˜éšçå¯¶ï¼' : 'å—šå—š...ç‰©å“åŠ£åŒ–æˆæ™®é€šé›œç‰©äº†'}
                         </p>
                         <div className="max-w-[160px] mx-auto transform rotate-2 hover:rotate-0 transition-transform">
                           <ItemCard item={alchemyResult.item} />
                         </div>
                         <button onClick={() => setAlchemyResult(null)} className="mt-6 text-sm font-bold text-slate-400 hover:text-slate-600 px-4 py-2 bg-white rounded-full border border-slate-200">å†ä¾†ä¸€æ¬¡</button>
                       </div>
                     )}

                     <div className="space-y-3">
                       <h3 className="text-sm font-bold text-slate-500 px-2 flex items-center gap-2">
                         <ShoppingBag size={14} /> é¸æ“‡åº«å­˜ç´ æ (éœ€4å€‹åŒéšç´š)ï¼š
                       </h3>
                       <div className="grid grid-cols-2 gap-3 max-h-[400px] overflow-y-auto pr-1 pb-20">
                         {sortedInventory.length === 0 && (
                           <div className="col-span-2 text-center py-10 bg-white rounded-2xl border border-dashed border-slate-300">
                             <p className="text-slate-400 font-bold">åº«å­˜ç©ºç©ºå¦‚ä¹Ÿï¼Œå»æŠ½çå§ï¼</p>
                           </div>
                         )}
                         {sortedInventory.map(item => (
                           <div key={item.id} className={`transition-opacity duration-200 ${selectedIds.includes(item.id) ? 'opacity-100 scale-95' : 'opacity-100'}`}>
                             <ItemCard 
                                item={item} 
                                isSelected={selectedIds.includes(item.id)} 
                                onClick={toggleSelection}
                              />
                           </div>
                         ))}
                       </div>
                     </div>
                  </div>
                )}

                {activeTab === 'inventory' && (
                  <div className="space-y-4 animate-fade-in">
                    <div className="bg-white p-2 rounded-2xl shadow-sm border border-pink-100">
                      <div className="flex justify-between items-center px-2 mb-3">
                        <h2 className="text-lg font-black text-slate-700 flex items-center gap-2">
                          <Ticket className="text-pink-400" /> æˆ‘çš„æ”¶è—
                        </h2>
                        <div className="flex bg-slate-100 p-1 rounded-full">
                          <button 
                            onClick={() => setInventoryView('owned')}
                            className={`px-3 py-1 rounded-full text-xs font-bold transition-all ${inventoryView === 'owned' ? 'bg-white shadow-sm text-pink-500' : 'text-slate-400 hover:text-slate-600'}`}
                          >
                             æŒæœ‰ç‰©å“
                          </button>
                          <button 
                            onClick={() => setInventoryView('collection')}
                            className={`px-3 py-1 rounded-full text-xs font-bold transition-all flex items-center gap-1 ${inventoryView === 'collection' ? 'bg-white shadow-sm text-pink-500' : 'text-slate-400 hover:text-slate-600'}`}
                          >
                             <BookOpen size={12}/> å…¨åœ–é‘‘
                          </button>
                        </div>
                      </div>

                      {inventoryView === 'owned' && (
                        <div className="grid grid-cols-5 gap-2 text-center text-[10px] animate-fade-in">
                           {Object.keys(TIERS).reverse().map(tier => {
                             const count = inventory.filter(i => i.tier === tier).length;
                             const style = TIERS[tier];
                             return (
                               <div key={tier} className={`flex flex-col items-center justify-center p-2 rounded-xl bg-slate-50 border ${style.border}`}>
                                 <div className="text-base mb-1">{style.icon}</div>
                                 <div className={`font-black ${style.color}`}>{tier}</div>
                                 <div className="text-slate-400 font-mono mt-1">{count}</div>
                               </div>
                             )
                           })}
                        </div>
                      )}
                    </div>

                    {inventoryView === 'owned' && (
                      <div className="grid grid-cols-2 gap-3 pb-20 animate-fade-in">
                        {sortedInventory.length === 0 && (
                          <div className="col-span-2 text-center py-20 text-slate-400">
                            <div className="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
                              <ShoppingBag size={24} className="opacity-50" />
                            </div>
                            <p className="font-bold">é€™è£¡ä»€éº¼éƒ½æ²’æœ‰...</p>
                            <p className="text-xs mt-1">å»æŠ½é»å¥½æ±è¥¿å§ï¼</p>
                          </div>
                        )}
                        {sortedInventory.map((item) => (
                          <ItemCard key={item.id} item={item} />
                        ))}
                      </div>
                    )}

                    {inventoryView === 'collection' && (
                      <div className="space-y-8 pb-20 animate-fade-in">
                        {Object.keys(TIERS).reverse().map(tier => (
                          <div key={tier} className="space-y-3">
                            <div className={`flex items-center gap-2 px-2 border-l-4 pl-3 ${TIERS[tier].border}`}>
                              <h3 className={`font-black text-lg ${TIERS[tier].color}`}>{TIERS[tier].label}</h3>
                              <span className="text-xs font-bold text-slate-400">{TIERS[tier].name}</span>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                               {ITEMS_DATA[tier].map(itemName => {
                                  const count = inventory.filter(i => i.name === itemName).length;
                                  const isOwned = count > 0;
                                  
                                  const mockItem = { id: itemName, tier: tier, name: itemName };
                                  
                                  return (
                                    <ItemCard 
                                      key={itemName} 
                                      item={mockItem} 
                                      isCollectionMode={true} 
                                      isOwned={isOwned} 
                                      count={count}
                                    />
                                  );
                               })}
                            </div>
                          </div>
                        ))}
                      </div>
                    )}

                  </div>
                )}

              </main>

              <nav className="fixed bottom-0 w-full bg-white/90 backdrop-blur-lg border-t border-pink-100 pb-safe z-50 rounded-t-3xl shadow-[0_-5px_20px_-5px_rgba(0,0,0,0.05)]">
                <div className="max-w-md mx-auto flex justify-around p-3">
                  <button 
                    onClick={() => setActiveTab('gacha')}
                    className={`flex flex-col items-center p-2 transition-all active:scale-95 ${activeTab === 'gacha' ? 'text-pink-500 -translate-y-2' : 'text-slate-400 hover:text-pink-400'}`}
                  >
                    <div className={`p-2 rounded-full ${activeTab === 'gacha' ? 'bg-pink-100 shadow-lg shadow-pink-200' : ''}`}>
                      <Sparkles size={24} className={activeTab === 'gacha' ? 'fill-pink-500' : ''} />
                    </div>
                    <span className="text-[10px] font-bold mt-1">è½‰è›‹</span>
                  </button>
                  
                  <button 
                    onClick={() => setActiveTab('alchemy')}
                    className={`flex flex-col items-center p-2 transition-all active:scale-95 ${activeTab === 'alchemy' ? 'text-rose-500 -translate-y-2' : 'text-slate-400 hover:text-rose-400'}`}
                  >
                    <div className={`relative p-2 rounded-full ${activeTab === 'alchemy' ? 'bg-rose-100 shadow-lg shadow-rose-200' : ''}`}>
                      <FlaskConical size={24} className={activeTab === 'alchemy' ? 'fill-rose-500' : ''} />
                      {activeTab !== 'alchemy' && inventory.length >= 4 && (
                        <span className="absolute top-0 right-0 w-3 h-3 bg-red-500 border-2 border-white rounded-full animate-ping"></span>
                      )}
                    </div>
                    <span className="text-[10px] font-bold mt-1">ç…‰é‡‘</span>
                  </button>

                  <button 
                    onClick={() => setActiveTab('inventory')}
                    className={`flex flex-col items-center p-2 transition-all active:scale-95 ${activeTab === 'inventory' ? 'text-blue-500 -translate-y-2' : 'text-slate-400 hover:text-blue-400'}`}
                  >
                    <div className={`p-2 rounded-full ${activeTab === 'inventory' ? 'bg-blue-100 shadow-lg shadow-blue-200' : ''}`}>
                      <ShoppingBag size={24} className={activeTab === 'inventory' ? 'fill-blue-500' : ''} />
                    </div>
                    <span className="text-[10px] font-bold mt-1">å€‰åº«</span>
                  </button>
                </div>
              </nav>

            </div>
          );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>